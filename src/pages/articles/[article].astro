---
import Layout from "../../layouts/Layout.astro";
import Footer from "../../components/Footer.astro";
import { markdown } from "@astropub/md";
import {
  getBlogDocByRoute,
  getBlogsList,
  getBloggerDoc,
} from "../../utils/blogs";
import { getFullAssetURL } from "../../utils/frappe";
export async function getStaticPaths() {
  const blogsList = await getBlogsList();

  const paths = blogsList.map((blog) => ({
    params: { article: blog.route },
  }));

  return paths;
}

const { article } = Astro.params;
const articleDoc = await getBlogDocByRoute(article);
const blogger = await getBloggerDoc(articleDoc.blogger);
const articleContent = await markdown(articleDoc.content_md);
---

<Layout title={articleDoc.title}>
  <!-- <pre>
    {JSON.stringify(articleDoc, null, 2)}
  </pre> -->

  <!-- <pre>
    {JSON.stringify(blogger, null, 2)}
  </pre> -->

  <img
    class="w-screen h-[40vh] object-cover"
    src={getFullAssetURL(articleDoc.meta_image)}
    alt="Blog Hero Image"
  />

  <div class="px-8 md:max-w-7xl md:mx-auto md:px-24 md:mt-16">
    <div
      class="my-10 prose prose-green prose-lg md:prose-xl prose-h2:text-green-900 prose-h1:text-green-700/70 prose-h1:font-black prose-h1:title prose-h1:text-4xl md:prose-h1:text-5xl"
    >
      <h1>{articleDoc.title}</h1>

      <div class="text-green-900/60 font-bold text-lg">
        <time datetime={articleDoc.published_on}>{articleDoc.published_on}</time
        >

        &nbsp; Â·

        <span>{articleDoc.read_time} min read</span>
      </div>

      <hr class="mt-5 border-green-800/20 border-1" />

      <div class="mt-5">
        {articleContent}
      </div>
    </div>

    <div class="flex items-center flex-col justify-center">
      <!-- About the author -->
      <h2 class="text-green-600/70 text-2xl md:text-3xl font-bold my-10">
        About the author
      </h2>

      <img
        class="w-32 h-32 rounded-full"
        src={getFullAssetURL(blogger.avatar)}
        alt={`${blogger.full_name}'s avatar image`}
      />

      <div class="flex flex-col items-center justify-center mt-4">
        <h4
          class="text-green-900 font-semibold text-xl md:text-2xl"
          title={blogger.full_name}
        >
          {blogger.full_name}
        </h4>
        <p class="text-green-900 text-lg md:text-xl font-normal mt-4">
          {blogger.bio}
        </p>
      </div>
    </div>
  </div>

  <Footer />
</Layout>
